<!DOCTYPE html>

<html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Bar-Tenders</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.slim.min.js"></script>
        <!--<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script> -->
         <link href="Bar-Tenders.css" rel="stylesheet">
    </head>


    <body>

        <header>
            <div class="branding">
                <a href="index.html"><img src="images/logoNoWords.png" alt="Bar-Tenders Logo" width="150" class="logo"></a>
                <img src="images/title.png" alt="Bar-Tenders" width="300" class="title">
            </div>

            <nav>
                <a href="index.html">Home</a>
            </nav>

        </header>

        <main>
            <div id="wrapper">
                <div id="signInBox">
                    
                </div>
            </div>    
        </main>

        <footer>
            &copy; 2025 Bar-Tenders
        </footer>

        <script>
            const signInBox = document.getElementById('signInBox');
            let isSignIn = true;

            // --- Render Sign In Form ---
            function renderSignInForm() {
                signInBox.innerHTML = `
                    <img src="images/sign_in.png" alt="Sign In" width="150px" height="60px" class="signInPageImage">
                    <p style="text-align: center;">Welcome back! Whether you're throwing <br>the party or bringing it, sign in here.</p>
                    <form id="loginForm">
                        <label for="email"><b>Email</b></label>
                        <input type="email" id="email" name="email" required><br><br>

                        <label for="password"><b>Password</b></label>
                        <input type="password" id="password" name="password" required><br><br>

                        <button type="submit">Sign In</button>
                    </form>
                    <a href="#" id="toggleLogInForm">Don't have an account? Sign up here.</a>
                `;

                // Handle form submission
                document.getElementById("loginForm").addEventListener("submit", async (e) => {
                    e.preventDefault();

                    const email = document.getElementById("email").value.trim();
                    const password = document.getElementById("password").value;

                    try {
                        const res = await fetch("/login", {
                            method: "POST",
                            headers: { "Content-Type": "application/json" },
                            body: JSON.stringify({ email, password }),
                            credentials: "include" // important for session cookies
                        });

                        if (res.ok) {
                            // Redirect to original page or index.html
                            const params = new URLSearchParams(window.location.search);
                            const redirect = params.get("redirect") || "index.html";
                            window.location.href = redirect;
                        } else {
                            const text = await res.text();
                            alert(text || "Invalid email or password.");
                        }
                    } catch (err) {
                        console.error(err);
                        alert("Server error. Please try again.");
                    }
                });

                document.getElementById('toggleLogInForm').addEventListener('click', toggleFormFunction);
            }

            // --- Render Sign Up Form ---
            function renderSignUpForm() {
                signInBox.innerHTML = `
                    <img src="images/create_account.png" alt="Create Account" width="300px" height="60px" class="signInPageImage">
                    <p style="text-align: center;">Enter your information</p>
                    <form method="post" action="/signup">
                        <label><b>First Name</b></label><br>
                        <input type="text" name="firstName" required><br><br>

                        <label><b>Last Name</b></label><br>
                        <input type="text" name="lastName" required><br><br>

                        <label><b>Email</b></label><br>
                        <input type="email" name="email" required><br><br>

                        <label><b>Phone Number</b></label><br>
                        <input type="tel" name="phoneNumber" required><br><br>

                        <label><b>Password</b></label><br>
                        <input type="password" name="password" required><br><br>

                        <label><b>Confirm Password</b></label><br>
                        <input type="password" name="confirmPassword" required><br><br>

                        <button type="submit">Sign Up</button>
                    </form>
                    <a href="#" id="toggleLogInForm">Already have an account? Sign in here.</a>
                `;

                document.getElementById('toggleLogInForm').addEventListener('click', toggleFormFunction);
            }

            // --- Toggle Between Sign In and Sign Up ---
            function toggleFormFunction(e) {
                e.preventDefault();
                isSignIn ? renderSignUpForm() : renderSignInForm();
                isSignIn = !isSignIn;
            }

            // --- Initial Render ---
            renderSignInForm();
        </script>



    </body>

</html>