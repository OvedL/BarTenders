<!DOCTYPE html>

<html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Bar-Tenders</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.slim.min.js"></script>
        <!--<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script> -->
         <link href="Bar-Tenders.css" rel="stylesheet">
    </head>


    <body>

        <header>
            <div class="branding">
                <a href="index.html"><img src="images/logoNoWords.png" alt="Bar-Tenders Logo" width="150" class="logo"></a>
                <img src="images/title.png" alt="Bar-Tenders" width="300" class="title">
            </div>

            <nav>
                <a href="index.html">Home</a>
                <a href="plan-event.html">Plan Event</a>
                <a href="interested.html">Interested in Bartending</a>
                <a href="manage_bartenders.html" class="manager-only" hidden>Manage Bartenders</a>
                <a href="signin.html" class="guest-only">Sign In</a>
                <div class="profile-dropdown auth-only" hidden>
                    <img src="images/defaultPFP.png" alt="Profile" width="30" class="profile-btn">
                    <div class="dropdown-content">
                        <a href="profile.html">Profile</a>
                        <a href="#" id="logoutLink">Logout</a>
                    </div>
                </div>
            </nav>

        </header>

        <main>
            <div id="wrapper" class="container mt-4">
                <div class="row">

                    <!-- Left: List of bartenders -->
                    <div class="col-2">
                        <h4>Bartenders</h4>
                        <ul id="bartenderList" class="list-group"></ul>
                    </div>

                    <!-- Right: Details panel -->
                    <div class="col-10">
                        <h4>Details</h4>
                        <div id="bartenderDetails" class="border rounded p-3 bg-light">
                            <p>Select a bartender from the list.</p>
                        </div>
                    </div>

                </div>
            </div>    
        </main>

        <footer>
            &copy; 2025 Bar-Tenders
        </footer>

        <script>
            //dynamic nav bar
            async function refreshNav() {
            try {
                const res = await fetch("/api/session"); // backend must provide this
                const { loggedIn, credentialID } = await res.json();

                console.log("Session Status:", {loggedIn, credentialID});

                document.querySelectorAll(".auth-only").forEach(el => el.hidden = !loggedIn);
                document.querySelectorAll(".guest-only").forEach(el => el.hidden = loggedIn);
                if ( credentialID >= 3 ) {
                    document.querySelectorAll(".manager-only").forEach(el => el.hidden = !loggedIn);
                }
            } catch (e) {
                console.error("Session check failed", e);
            }
            }

            //logout
            document.addEventListener("click", async (e) => {
            if (e.target.id === "logoutLink") {
                e.preventDefault();
                const res = await fetch("/api/logout", { method: "POST" });
                const data = await res.json();

                if (data.success) {
                    window.location.href = data.redirect;
                } else {
                    alert("Logout failed, please try again.");
                }
            }
            });

            async function loadBartenders() {
                try {
                    const res = await fetch("/api/bartenders");
                    const data = await res.json();

                    if (!data.success) {
                        document.getElementById("bartenderList").innerHTML =
                            "<li class='list-group-item'>Failed to load bartenders.</li>";
                        return;
                    }

                    const list = document.getElementById("bartenderList");

                    list.innerHTML = ""; // clear

                    data.bartenders.forEach((b, index) => {
                        const li = document.createElement("li");
                        li.className = "list-group-item list-group-item-action";
                        li.style.cursor = "pointer";

                        li.textContent = `${b.fullName}`;

                        // Store data onto the element
                        li.addEventListener("click", () => showDetails(b));

                        list.appendChild(li);
                    });

                } catch (err) {
                    console.error(err);
                    document.getElementById("bartenderList").innerHTML =
                        "<li class='list-group-item'>Error loading bartenders.</li>";
                }
            }

            function showDetails(b) {
                const panel = document.getElementById("bartenderDetails");

                panel.innerHTML = `
                    <h5>${b.fullName}</h5>
                    <p><strong>Phone:</strong> ${b.phoneNumber}</p>
                    <p><strong>Email:</strong> ${b.email}</p>
                    <p><strong>Years of Service:</strong> ${b.yearsOfService}</p>
                    <p><strong>Bio:</strong> ${b.bio || "N/A"}</p>
                    <p><strong>Prior Events:</strong> ${b.priorEvents || "N/A"}</p>
                    <p><strong>Location:</strong> ${b.city}, ${b.state}</p>
                `;
            }





            refreshNav();
            loadBartenders();
        </script>

    </body>

</html>